<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>åˆ©æ½¤æ”¶ç›Šè¨ˆç®—å™¨</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{
    margin:0;
    font-family:"Segoe UI",sans-serif;
    background: linear-gradient(135deg,#fbcfe8,#e9d5ff,#bfdbfe);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
}

/* ğŸŒ¸ æ„›å¿ƒæ¼‚æµ® */
.heart{
    position:absolute;
    color:rgba(255,105,180,0.35);
    font-size:20px;
    animation: float 10s linear infinite;
}

@keyframes float{
    from{transform:translateY(100vh) scale(0.5);}
    to{transform:translateY(-10vh) scale(1.2);}
}

/* ä¸»å®¹å™¨ */
.container{
    background: rgba(255,255,255,0.9);
    padding:35px 40px;
    border-radius:25px;
    width:760px;
    box-shadow:0 20px 50px rgba(236,72,153,0.25);
    backdrop-filter: blur(10px);
    position:relative;
    z-index:10;
}

h2{
    text-align:center;
    color:#db2777;
    margin-bottom:6px;
}

.note{
    text-align:center;
    font-size:13px;
    color:#7c3aed;
    margin-bottom:20px;
}

table{width:100%;border-collapse:collapse;}
th{color:#a21caf;padding:10px;}
td{padding:10px;text-align:center;}

input{
    width:110px;
    padding:7px;
    border-radius:12px;
    border:1px solid #f9a8d4;
    text-align:center;
}

button{
    border:none;
    border-radius:18px;
    padding:10px 18px;
    cursor:pointer;
    transition:0.25s;
}

.add-wrapper{
    display:flex;
    justify-content:center;
    margin:18px 0 10px 0;
}

.add{
    background: linear-gradient(135deg,#f472b6,#ec4899);
    color:white;
    font-size:22px;
    width:52px;
    height:52px;
    border-radius:50%;
    box-shadow:0 8px 20px rgba(236,72,153,0.35);
}

.run{
    background: linear-gradient(135deg,#a78bfa,#818cf8);
    color:white;
    width:100%;
    margin-top:12px;
    box-shadow:0 10px 25px rgba(129,140,248,0.35);
    position:relative;
    overflow:hidden;
}

/* âœ¨ é–ƒå…‰å‹•ç•« */
.run.sparkle::after{
    content:"âœ¨âœ¨âœ¨";
    position:absolute;
    left:-20%;
    top:0;
    width:140%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:22px;
    animation:sparkle 0.8s ease;
}

@keyframes sparkle{
    from{opacity:0; transform:translateX(-40px);}
    to{opacity:1; transform:translateX(40px);}
}

.delete{
    background:#fb7185;
    color:white;
    border-radius:12px;
    padding:6px 10px;
}

.summary{
    margin-top:18px;
    text-align:center;
    font-size:20px;
    font-weight:600;
    color:#16a34a;
}

/* ğŸ‘‘ Loading */
.loading{
    position:fixed;
    inset:0;
    background:rgba(255,240,250,0.9);
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:28px;
    color:#db2777;
    z-index:999;
    display:none;
}

/* ğŸ’¥ ç…™ç« */
.firework{
    position:fixed;
    font-size:24px;
    animation: boom 1s ease-out forwards;
    pointer-events:none;
}

@keyframes boom{
    from{transform:scale(0.2); opacity:1;}
    to{transform:scale(2); opacity:0;}
}
</style>
</head>

<body>

<!-- ğŸŒ¸ æ„›å¿ƒ -->
<script>
for(let i=0;i<20;i++){
    const heart=document.createElement("div");
    heart.className="heart";
    heart.innerText="ğŸ’–";
    heart.style.left=Math.random()*100+"vw";
    heart.style.animationDelay=Math.random()*10+"s";
    heart.style.fontSize=(Math.random()*20+16)+"px";
    document.body.appendChild(heart);
}
</script>

<div class="container">
<h2>ğŸ’ åˆ©æ½¤æ”¶ç›Šè¨ˆç®—å™¨</h2>
<div class="note">å¦‚éœ€åŒ¯å‡º Excel æª”ï¼Œè«‹åœ¨åŸ·è¡Œè¨ˆç®—å¾ŒæŒ‰ã€Œç¹¼çºŒã€</div>

<table id="table">
<thead>
<tr>
<th>å”®åƒ¹</th>
<th>æˆæœ¬</th>
<th>æ·¨åˆ©</th>
<th>åˆªé™¤</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="add-wrapper">
<button class="add" onclick="addRow()">ï¼‹</button>
</div>

<button class="run" id="runBtn" onclick="calculate()">âœ¨ åŸ·è¡Œè¨ˆç®— âœ¨</button>

<div class="summary" id="summary"></div>
</div>

<div class="loading" id="loading">
ğŸ‘‘ è¨ˆç®—ä¸­ âœ¨
</div>

<script>
function addRow(){
    const tbody=document.querySelector("#table tbody");
    const row=document.createElement("tr");
    row.innerHTML=`
        <td><input type="number" step="0.01"></td>
        <td><input type="number" step="0.01"></td>
        <td class="profit">0.00</td>
        <td><button class="delete" onclick="deleteRow(this)">X</button></td>
    `;
    tbody.appendChild(row);
}

function deleteRow(btn){
    btn.closest("tr").remove();
}

function calculate(){
    const runBtn=document.getElementById("runBtn");

    /* âœ¨ é–ƒå…‰ */
    runBtn.classList.add("sparkle");
    setTimeout(()=>runBtn.classList.remove("sparkle"),800);

    /* ğŸ‘‘ Loading */
    const loading=document.getElementById("loading");
    loading.style.display="flex";

    setTimeout(()=>{
        loading.style.display="none";
        doCalculation();
        launchFireworks();
    },900);
}

function doCalculation(){
    const rows=document.querySelectorAll("#table tbody tr");
    let totalProfit=0;
    let data=[["å”®åƒ¹","æˆæœ¬","æ·¨åˆ©"]];

    rows.forEach(row=>{
        const inputs=row.querySelectorAll("input");
        const sell=parseFloat(inputs[0].value)||0;
        const cost=parseFloat(inputs[1].value)||0;
        const profit=sell-cost;

        totalProfit+=profit;
        row.querySelector(".profit").innerText=profit.toFixed(2);

        data.push([sell.toFixed(2),cost.toFixed(2),profit.toFixed(2)]);
    });

    document.getElementById("summary").innerHTML=
        `ğŸ’° ç¸½åˆ©ç›Šï¼š${totalProfit.toFixed(2)}`;

    setTimeout(()=>askContinue(data,totalProfit),200);
}

function askContinue(data,totalProfit){
    const cont=confirm(
        `è¨ˆç®—å®Œæˆ âœ¨\n\nç¸½åˆ©ç›Šï¼š${totalProfit.toFixed(2)}\n\næ˜¯å¦åŒ¯å‡º Excelï¼Ÿ`
    );

    if(cont) exportExcel(data,totalProfit);
}

function exportExcel(data,totalProfit){
    data.push([]);
    data.push(["ç¸½åˆ©ç›Š",totalProfit.toFixed(2)]);

    const ws=XLSX.utils.aoa_to_sheet(data);
    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"åˆ©æ½¤å ±è¡¨");
    XLSX.writeFile(wb,"åˆ©æ½¤å ±è¡¨.xlsx");
}

/* ğŸ’¥ ç…™ç« */
function launchFireworks(){
    for(let i=0;i<12;i++){
        const fw=document.createElement("div");
        fw.className="firework";
        fw.innerText=["âœ¨","ğŸ’–","ğŸ’","ğŸŒ¸"][Math.floor(Math.random()*4)];
        fw.style.left=Math.random()*100+"vw";
        fw.style.top=Math.random()*100+"vh";
        document.body.appendChild(fw);

        setTimeout(()=>fw.remove(),1000);
    }
}

addRow();
</script>

</body>
</html>
