<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>å¤¢å¹»å…¬ä¸»åˆ©æ½¤è¨ˆç®—å™¨</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{
    margin:0;
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(135deg,#fbcfe8,#e9d5ff,#bfdbfe);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.container{
    background: rgba(255,255,255,0.85);
    padding:35px;
    border-radius:25px;
    width:720px;
    box-shadow:0 20px 50px rgba(236,72,153,0.25);
    backdrop-filter: blur(10px);
}

h2{
    text-align:center;
    margin-bottom:25px;
    color:#db2777;
    font-weight:600;
    letter-spacing:1px;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-bottom:20px;
}

th{
    color:#a21caf;
    font-weight:500;
    padding:10px;
}

td{
    padding:8px;
    text-align:center;
}

input{
    width:110px;
    padding:7px;
    border-radius:12px;
    border:1px solid #f9a8d4;
    background:white;
    text-align:center;
    font-size:14px;
}

button{
    border:none;
    border-radius:18px;
    padding:10px 18px;
    cursor:pointer;
    font-size:14px;
    transition:0.25s;
    font-weight:500;
}

.add{
    background: linear-gradient(135deg,#f472b6,#ec4899);
    color:white;
    font-size:20px;
    width:46px;
    height:46px;
    border-radius:50%;
    box-shadow:0 8px 20px rgba(236,72,153,0.4);
}

.add:hover{transform:scale(1.1);}

.run{
    background: linear-gradient(135deg,#a78bfa,#818cf8);
    color:white;
    width:100%;
    margin-top:10px;
    box-shadow:0 10px 25px rgba(129,140,248,0.35);
}

.run:hover{transform:translateY(-1px);}

.delete{
    background:#fb7185;
    color:white;
    border-radius:12px;
}

.delete:hover{background:#f43f5e;}

.summary{
    margin-top:15px;
    text-align:center;
    font-size:20px;
    font-weight:600;
    color:#16a34a;
}
</style>
</head>

<body>

<div class="container">
<h2>ğŸ‘‘ å¤¢å¹»å…¬ä¸»åˆ©æ½¤è¨ˆç®—å™¨</h2>

<table id="table">
<thead>
<tr>
<th>å”®åƒ¹</th>
<th>æˆæœ¬</th>
<th>æ·¨åˆ©</th>
<th>åˆªé™¤</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div style="text-align:center;">
<button class="add" onclick="addRow()">ï¼‹</button>
</div>

<button class="run" onclick="calculate()">âœ¨ åŸ·è¡Œè¨ˆç®— âœ¨</button>

<div class="summary" id="summary"></div>
</div>

<script>

function addRow(){
    const tbody=document.querySelector("#table tbody");
    const row=document.createElement("tr");
    row.innerHTML=`
        <td><input type="number" step="0.01"></td>
        <td><input type="number" step="0.01"></td>
        <td class="profit">0.00</td>
        <td><button class="delete" onclick="deleteRow(this)">X</button></td>
    `;
    tbody.appendChild(row);
}

function deleteRow(btn){
    btn.closest("tr").remove();
}

function calculate(){
    const rows=document.querySelectorAll("#table tbody tr");
    let totalProfit=0;
    let data=[["å”®åƒ¹","æˆæœ¬","æ·¨åˆ©"]];

    rows.forEach(row=>{
        const inputs=row.querySelectorAll("input");
        const sell=parseFloat(inputs[0].value)||0;
        const cost=parseFloat(inputs[1].value)||0;
        const profit=sell-cost;

        totalProfit+=profit;
        row.querySelector(".profit").innerText=profit.toFixed(2);

        data.push([
            sell.toFixed(2),
            cost.toFixed(2),
            profit.toFixed(2)
        ]);
    });

    document.getElementById("summary").innerHTML=
        `ğŸ’° ç¸½åˆ©ç›Šï¼š${totalProfit.toFixed(2)}`;

    setTimeout(()=>{
        askContinue(data,totalProfit);
    },200);
}

function askContinue(data,totalProfit){
    const cont=confirm(
        `è¨ˆç®—å®Œæˆ âœ¨\n\nç¸½åˆ©ç›Šï¼š${totalProfit.toFixed(2)}\n\næ˜¯å¦ç¹¼çºŒï¼Ÿ\n(æ˜¯ = åŒ¯å‡º Excel)`
    );

    if(cont){
        exportExcel(data,totalProfit);
    }else{
        resetAll();
    }
}

function exportExcel(data,totalProfit){
    data.push([]);
    data.push(["ç¸½åˆ©ç›Š",totalProfit.toFixed(2)]);

    const ws=XLSX.utils.aoa_to_sheet(data);
    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"å…¬ä¸»åˆ©æ½¤å ±è¡¨");
    XLSX.writeFile(wb,"å…¬ä¸»åˆ©æ½¤å ±è¡¨.xlsx");

    resetAll();
}

function resetAll(){
    document.querySelector("#table tbody").innerHTML="";
    document.getElementById("summary").innerHTML="";
    addRow();
}

addRow();

</script>

</body>
</html>
